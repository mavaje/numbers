(()=>{"use strict";(()=>{class t{element;static instances=[];position=[0,0];size;elevation=0;mass=1;velocity=[0,0];transforms=[];_hovering=!1;_dragging=!1;draggable=!0;pressable=!1;updatable=!1;physics_enabled=!0;shadow;constructor(e){this.element=e,t.instances.push(this),e.classList.add("block"),e.addEventListener("mouseenter",(()=>this.hover_start())),e.addEventListener("touchstart",(()=>{this.hover_start(),this.dragging=!0})),e.addEventListener("mouseleave",(()=>this.hover_end())),document.body.addEventListener("touchend",(()=>{this.dragging=!1,this.hover_end()})),this.shadow=document.createElement("div"),this.shadow.classList.add("shadow"),document.body.append(this.shadow)}hover_start(){this.hovering=!0}hover_end(){this.hovering=!1}set hovering(t){this._hovering=t,this.update()}get hovering(){return this._hovering}set dragging(t){t!==this._dragging&&(this._dragging=t,t?(this.draggable&&(this.elevation+=100,this.on_lift()),this.on_click_start()):(this.draggable&&(this.elevation-=100,this.on_drop()),this.on_click_release()),this.update())}get dragging(){return this._dragging}get centre(){return[this.position[0]+this.size[0]/2,this.position[1]+this.size[1]/2]}set_position(t){this.position=t,this.update()}move(t){this.velocity[0]=(this.velocity[0]+t[0])/2,this.velocity[1]=(this.velocity[1]+t[1])/2,this.position[0]+=t[0],this.position[1]+=t[1],this.on_move(),this.update()}update(){this.element.style.width=`${this.size[0]}px`,this.element.style.height=`${this.size[1]}px`,this.element.style.left=`${this.position[0]}px`,this.element.style.top=`${this.position[1]}px`,this.element.style.transform=[`translateZ(${this.elevation}px)`,...this.transforms].join(" "),this.shadow.style.left=`${this.position[0]+12}px`,this.shadow.style.top=`${this.position[1]+12}px`,this.shadow.style.width=this.size[0]-24+"px",this.shadow.style.height=this.size[1]-24+"px",this.shadow.classList.remove("lifted","pressed");const t=this.draggable?"lifted":this.pressable?"pressed":null;t&&this.dragging&&this.shadow.classList.add(t)}collides(t){return this.position[0]<t.position[0]+t.size[0]&&this.position[1]<t.position[1]+t.size[1]&&t.position[0]<this.position[0]+this.size[0]&&t.position[1]<this.position[1]+this.size[1]}on_lift(){}on_drop(){}on_move(){}on_click_start(){}on_click_release(){}}let e=[0,0];document.addEventListener("pointerdown",(()=>{t.instances.forEach((t=>{t.hovering&&(t.dragging=!0)}))})),document.addEventListener("pointermove",(({x:n,y:s})=>{t.instances.forEach((t=>{t.draggable&&t.dragging&&t.move([n-e[0],s-e[1]])})),e=[n,s]})),document.addEventListener("pointerup",(()=>{t.instances.forEach((t=>{t.dragging=!1}))}));let n=null;window.requestAnimationFrame((function e(s){for(n||(n=s);n<s;){t.instances.forEach(((e,n)=>{!e.dragging&&e.physics_enabled&&t.instances.slice(n+1).forEach((t=>{if(!t.dragging&&t.physics_enabled&&e.collides(t)){const n=[t.centre[0]-e.centre[0],t.centre[1]-e.centre[1]],s=n.map((t=>Math.sign(t))),i=Math.sqrt(n[0]**2+n[1]**2)||1,o=[0,0];Math.sign(e.velocity[0])!==-s[0]&&(o[0]+=Math.abs(e.velocity[0])*e.mass),Math.sign(e.velocity[1])!==-s[1]&&(o[1]+=Math.abs(e.velocity[1])*e.mass),Math.sign(t.velocity[0])!==s[0]&&(o[0]+=Math.abs(t.velocity[0])*t.mass),Math.sign(t.velocity[1])!==s[1]&&(o[1]+=Math.abs(t.velocity[1])*t.mass);let a=[o[0]*s[0],o[1]*s[1]];0===a[0]&&0===a[1]&&(a=n.map((t=>t/i))),e.draggable&&t.draggable||(a=a.map((t=>2*t))),e.draggable&&(e.velocity[0]-=a[0]/e.mass,e.velocity[1]-=a[1]/e.mass),t.draggable&&(t.velocity[0]+=a[0]/t.mass,t.velocity[1]+=a[1]/t.mass)}}))}));const e=[document.body.offsetWidth,document.body.offsetHeight];t.instances.forEach((t=>{!t.dragging&&t.draggable&&t.physics_enabled&&(t.position[0]<50&&(t.velocity[0]+=Math.max(1,-2*t.velocity[0])),t.position[1]<50&&(t.velocity[1]+=Math.max(1,-2*t.velocity[1])),t.position[0]+t.size[0]>e[0]-50&&(t.velocity[0]-=Math.max(1,2*t.velocity[0])),t.position[1]+t.size[1]>e[1]-50&&(t.velocity[1]-=Math.max(1,2*t.velocity[1])),Math.abs(t.velocity[0])>.1||Math.abs(t.velocity[1])>.1?(t.velocity=t.velocity.map((t=>Math.min(100,Math.abs(t))*Math.sign(t))),t.move(t.velocity),t.velocity[0]*=.8,t.velocity[1]*=.8):(t.velocity[0]=0,t.velocity[1]=0))})),t.instances.forEach((t=>{t.updatable&&t.update()})),n+=10}window.requestAnimationFrame(e)}));class s extends t{static SIZE=30;size=[s.SIZE,s.SIZE];draggable=!1;physics_enabled=!1;pressable=!0;updatable=!0;on_press;is_active;pressed=0;static create(t,e,n,i){const o=new s(t,e,n);return o.set_position(i),document.body.append(o.element),o}constructor(t,e,n){const s=document.createElement("div");s.classList.add("block-button"),super(s),this.on_press=e,this.is_active=n,t.classList.add("face","front"),s.append(t),["left","right","top","bottom"].forEach((t=>{const e=document.createElement("div");e.classList.add("face",t),s.append(e)}))}update(){this.pressable=this.pressed>0||this.is_active(),this.pressable?this.element.classList.add("enabled"):this.element.classList.remove("enabled"),super.update()}on_click_start(){this.is_active()&&!this.pressed&&(this.pressed=Date.now(),this.elevation-=5,this.element.classList.add("pressed"),this.on_press())}on_click_release(){this.pressed&&setTimeout((()=>{this.pressed=null,this.elevation+=5,this.element.classList.remove("pressed"),this.update()}),Math.max(0,this.pressed+200-Date.now()))}}function i(t,e,n=32){if(!e.parentNode||!e.offsetWidth||!e.offsetHeight)return setTimeout((()=>i(t,e,n))),e;const s=document.createElement("span");s.classList.add("text"),e.append(s),s.append(t);const o=n;for(s.style.fontSize=`${n}px`;s.scrollWidth+4>e.offsetWidth||s.scrollHeight+4>e.offsetHeight;)n>7?s.style.fontSize=--n+"px":"break-all"!==s.style.wordBreak?(s.style.wordBreak="break-all",s.style.fontSize=`${n=o}px`):s.innerText=s.innerText.slice(0,-4)+"...";return e}class o{clazz;show_passed;show_failed;test_count=0;test_success_count=0;test_failure_count=0;constructor(t,e=!1,n=!1){this.clazz=t,this.show_passed=e,this.show_failed=n}create(...t){return new this.clazz(...t)}subject(...t){const e=this.create(...t);return new a(this,e)}record_success(t){this.test_count++,this.test_success_count++,this.show_passed&&console.log(t)}record_failure(t){this.test_count++,this.test_failure_count++,this.show_failed&&console.error(t)}summarise(){this.test_failure_count>0?console.log(`❌ FAILED ${this.test_failure_count}/${this.test_count} TESTS!`):console.log(`✅ PASSED ALL ${this.test_count} TESTS!`)}}class a{tester;subject;constructor(t,e){this.tester=t,this.subject=e}expect(t,...e){const n=this.subject[t](...e);return new r(this.tester,`${this.subject}.${t}(${e.join(", ")})`,n)}}class r{tester;operation;result;constructor(t,e,n){this.tester=t,this.operation=e,this.result=n}to_equal(t,e=!1){return(e?this.result===t:this.result==t)?(this.tester.record_success(`✅ PASS - ${this.operation} = ${t}`),!0):(this.tester.record_failure(`❌ FAIL - ${this.operation} != ${t}, got ${this.result}`),!1)}to_be_truthy(){return this.result?(this.tester.record_success(`✅ PASS - ${this.operation} = ${this.result}`),!0):(this.tester.record_failure(`❌ FAIL - ${this.operation} to be truthy, got ${this.result}`),!1)}}var c;!function(t){t[t.IN=0]="IN",t[t.OUT=1]="OUT",t[t.UP=2]="UP",t[t.DOWN=3]="DOWN",t[t.EVEN=4]="EVEN",t[t.ODD=5]="ODD",t[t.HALF_IN=6]="HALF_IN",t[t.HALF_OUT=7]="HALF_OUT",t[t.HALF_UP=8]="HALF_UP",t[t.HALF_DOWN=9]="HALF_DOWN",t[t.HALF_EVEN=10]="HALF_EVEN",t[t.HALF_ODD=11]="HALF_ODD"}(c||(c={}));class l{static UNDEFINED=new l(0n,0n);static ZERO=new l(0n);static THOUSANDTH=new l(1n,1000n);static HUNDREDTH=new l(1n,100n);static TENTH=new l(1n,10n);static HALF=new l(1n,2n);static ONE=new l(1n);static TWO=new l(2n);static TEN=new l(10n);static HUNDRED=new l(100n);static THOUSAND=new l(1000n);static INFINITY=new l(1n,0n);static NEGATIVE_ONE=new l(-1n);static NEGATIVE_INFINITY=new l(-1n,0n);numerator;denominator;constructor(t,e=1n){let n,s;if("bigint"==typeof t?(n=t,s=1n):[n,s]=l.float_as_fraction(t),"bigint"==typeof e)s*=e;else{const[t,i]=l.float_as_fraction(e);n*=i,s*=t}if(0n===n)this.numerator=0n,this.denominator=0n===s?0n:1n;else if(s<0&&(n=-n,s=-s),0n===s)this.numerator=n<0n?-1n:1n,this.denominator=0n;else{let t=n<0n?-n:n,e=s;for(;e>0n;)[t,e]=[e,t%e];this.numerator=n/t,this.denominator=s/t}}static float_as_fraction(t){if(t%1==0)return[BigInt(t),1n];const e=2n**52n,n=new ArrayBuffer(8);new DataView(n).setFloat64(0,t);let s="";for(let t of new Uint8Array(n))s+=t.toString(2).padStart(8,"0");const i="0"===s[0]?1n:-1n,o=BigInt("0b"+s.slice(1,12)),a=BigInt("0b"+s.slice(12));if(0n===o)return 0n===a?[0n,1n]:[i*a,e*2n**1022n];if(2047n===o)return 0n===a?[i,0n]:[0n,0n];{const t=o-1023n,n=e+a;return t<0?[i*n,e*2n**-t]:[i*n*2n**t,e]}}sign(){switch(!0){case this.is_negative():return-1;case this.is_zero():return 0;case this.is_positive():return 1}}is_negative(){return this.numerator<0n}is_zero(){return 0n===this.numerator}is_positive(){return this.numerator>0n}is_integer(){return 1n===this.denominator}is_even(){return this.divide(l.TWO).is_integer()}is_odd(){return 2n===this.divide(l.TWO).denominator}is_fractional(){return this.denominator>1n}is_finite(){return this.denominator>0n}is_infinite(){return 0n===this.denominator}is_undefined(){return 0n===this.numerator&&0n===this.denominator}negative(){return new l(-this.numerator,this.denominator)}absolute(){return this.is_negative()?this.negative():this}reciprocal(){return new l(this.denominator,this.numerator)}truncate(t,e){return this.round(c.IN,t,e)}ceiling(t,e){return this.round(c.UP,t,e)}floor(t,e){return this.round(c.DOWN,t,e)}round(t=c.HALF_OUT,e=l.ONE,n){if(this.is_infinite())return this;if(e instanceof l||(e=new l(e,n)),e.is_zero()||e.is_infinite())return l.UNDEFINED;let s=this.divide(e);if(s.is_integer())return s.times(e);t>=6&&(2n===s.denominator?t-=6:(t=c.DOWN,s=s.plus(l.HALF)));const i=new l(s.numerator/s.denominator);return[c.IN,s.is_negative()?c.UP:c.DOWN,i.is_even()?c.EVEN:c.ODD].includes(t)?i.times(e):s.is_negative()?i.minus(l.ONE).times(e):i.plus(l.ONE).times(e)}equals(t,e){return t instanceof l||(t=new l(t,e)),this.numerator===t.numerator&&this.denominator===t.denominator}not_equals(t,e){return!this.equals(t,e)}is_less_than(t,e){return t instanceof l||(t=new l(t,e)),this.numerator*t.denominator<t.numerator*this.denominator}is_not_less_than(t,e){return!this.is_less_than(t,e)}is_greater_than(t,e){return t instanceof l||(t=new l(t,e)),this.numerator*t.denominator>t.numerator*this.denominator}is_not_greater_than(t,e){return!this.is_greater_than(t,e)}plus(t,e){return t instanceof l||(t=new l(t,e)),this.equals(t)?this.times(l.TWO):new l(this.numerator*t.denominator+t.numerator*this.denominator,this.denominator*t.denominator)}minus(t,e){return t instanceof l||(t=new l(t,e)),this.plus(t.negative())}times(t,e){return t instanceof l||(t=new l(t,e)),new l(this.numerator*t.numerator,this.denominator*t.denominator)}divide(t,e){return t instanceof l||(t=new l(t,e)),this.times(t.reciprocal())}modulo(t,e){return t instanceof l||(t=new l(t,e)),this.is_finite()&&t.is_infinite()?t.is_undefined()||this.sign()*t.sign()<0?t:this:this.minus(this.floor(t))}power(t){return t<0n?new l(this.denominator**-t,this.numerator**-t):new l(this.numerator**t,this.denominator**t)}static positional(t,e){if(e instanceof l||(e=new l(e)),t.is_negative()&&e.is_positive())return{...l.positional(t.negative(),e),sign:-1};if(e.is_infinite()||e.is_zero()||e.absolute().equals(l.ONE))throw new Error(`Invalid base ${e}`);if(e.absolute().is_less_than(l.ONE)){let{sign:n,integer_digits:s,fraction_digits:i,integer_repeat:o,fraction_repeat:a}=l.positional(t,e.reciprocal());return{sign:n,integer_digits:i,fraction_digits:s,integer_repeat:a,fraction_repeat:o}}const n=[],s=[];let i=0;n[0]=t.numerator;let o=0;for(;;){let t=n[o]/e.numerator;if(n[o]%e.numerator<0n&&t++,0n===t)break;n[o]-=t*e.numerator,n[++o]=t*e.denominator}const a=o;s[0]=n[0];const r=[];if(t.is_fractional()){let c,u,h=l.ZERO;for(;o>=-100;){if(c=h.times(e).plus(n[o]??l.ZERO),h=c.modulo(t.denominator),u=c.minus(h).divide(t.denominator),o>=0&&(n[o]=u.numerator),o<=0){s[-o]=u.numerator;const t=r.findIndex((t=>t.equals(h)));if(o<0&&t>-1){i=r.length-t;break}if(r.push(h),h.is_zero())break}o--}for(;o<a;){const t=n[o]??s[-o]??0n;let a=t/e.numerator;t%e.numerator<0n&&a++,0n!==a&&(1===i&&-o==s.length-i&&(i++,s[i-o-1]=s[i-o-2]),o>=0&&(n[o]-=a*e.numerator),o<=0&&(s[-o]-=a*e.numerator),o>=-1&&(n[o+1]??=0n,n[o+1]+=a*e.denominator),o<=-1&&(s[-o-1]+=a*e.denominator),-o==s.length-i&&(o-=i,s[-o-1]+=a*e.denominator)),o++}}const c=n.findLastIndex((t=>0n!==t));if(c>-1&&n.splice(c+1,n.length),0===i){const t=s.findLastIndex((t=>0n!==t));t>-1&&s.splice(t+1,s.length)}return{sign:t.is_zero()?0:1,integer_digits:n,fraction_digits:s,fraction_repeat:i}}to_positional(t={}){if(this.is_undefined())return"NAN";if(this.is_infinite())return this.negative()?"-∞":"∞";let{base:e=l.TEN,point:n=".",digit_separator:s,integer:i={},fraction:o={}}=t;e instanceof l||(e=new l(e));const a=l.positional(this,e),r=Math.max(Math.abs(Number(e.numerator)),Math.abs(Number(e.denominator)));s??=r>36?":":"";const c=a.integer_digits.reverse().map((t=>t.toString(r)));for(;c.length<(i.min_digits??1);)a.integer_repeat?(c.push(...c.slice(-a.integer_repeat)),c.splice(i.min_digits??1,c.length-(i.min_digits??1))):c.push("0");let u;const h=i.digit_separator??s;if(a.integer_repeat&&!("max_digits"in i)){const t=a.integer_repeat;u=t>1?`...[${c.slice(0,t).join(h)}]${c.slice(t).join(h)}`:`...${c.join(h)}`}else u=c.slice(0,i.max_digits??c.length).join(h);const d=a.fraction_digits.map((t=>t.toString(r)));for(;d.length<(o.min_digits??0)+1;)a.fraction_repeat?(d.push(...d.slice(-a.fraction_repeat)),d.splice((o.min_digits??0)+1,d.length-(o.min_digits??0)-1)):d.push("0");let p;const _=o.digit_separator??s;if(a.fraction_repeat&&!("max_digits"in o)){const t=a.fraction_repeat;p=t>1?`${d.slice(1,-t).join(_)}[${d.slice(-t).join(_)}]...`:`${d.slice(1).join(_)}...`}else p=d.slice(1).slice(0,o.max_digits??d.length).join(_);return(-1===a.sign?"-":"")+u+(p.length>0?n:"")+p}to_float(){return Number(this.numerator)/Number(this.denominator)}toString(){return`[${this.numerator}/${this.denominator}]`}static test(t=!0,e=!0){const n=new o(l,t,e);n.subject(0n,0n).expect("equals",0n,0n).to_be_truthy(),n.subject(-1n,0n).expect("equals",-1n,0n).to_be_truthy(),n.subject(-2n,1n).expect("equals",-2n,1n).to_be_truthy(),n.subject(-3n,2n).expect("equals",-3n,2n).to_be_truthy(),n.subject(-1n,1n).expect("equals",-1n,1n).to_be_truthy(),n.subject(-1n,2n).expect("equals",-1n,2n).to_be_truthy(),n.subject(0n,1n).expect("equals",0n,1n).to_be_truthy(),n.subject(1n,2n).expect("equals",1n,2n).to_be_truthy(),n.subject(1n,1n).expect("equals",1n,1n).to_be_truthy(),n.subject(3n,2n).expect("equals",3n,2n).to_be_truthy(),n.subject(2n,1n).expect("equals",2n,1n).to_be_truthy(),n.subject(1n,0n).expect("equals",1n,0n).to_be_truthy(),n.subject(0n,1n).expect("equals",0n,-1n).to_be_truthy(),n.subject(-1n,-1n).expect("equals",1n,1n).to_be_truthy(),n.subject(-1n,1n).expect("equals",1n,-1n).to_be_truthy(),n.subject(4n,2n).expect("equals",2n,1n).to_be_truthy(),n.subject(9n,24n).expect("equals",3n,8n).to_be_truthy(),n.subject(0n,0n).expect("reciprocal").to_equal("[0/0]"),n.subject(-1n,0n).expect("reciprocal").to_equal("[0/1]"),n.subject(-2n,1n).expect("reciprocal").to_equal("[-1/2]"),n.subject(-3n,2n).expect("reciprocal").to_equal("[-2/3]"),n.subject(-1n,1n).expect("reciprocal").to_equal("[-1/1]"),n.subject(-1n,2n).expect("reciprocal").to_equal("[-2/1]"),n.subject(0n,1n).expect("reciprocal").to_equal("[1/0]"),n.subject(1n,2n).expect("reciprocal").to_equal("[2/1]"),n.subject(1n,1n).expect("reciprocal").to_equal("[1/1]"),n.subject(3n,2n).expect("reciprocal").to_equal("[2/3]"),n.subject(2n,1n).expect("reciprocal").to_equal("[1/2]"),n.subject(1n,0n).expect("reciprocal").to_equal("[0/1]"),n.subject(0n,0n).expect("negative").to_equal("[0/0]"),n.subject(-1n,0n).expect("negative").to_equal("[1/0]"),n.subject(-2n,1n).expect("negative").to_equal("[2/1]"),n.subject(-3n,2n).expect("negative").to_equal("[3/2]"),n.subject(-1n,1n).expect("negative").to_equal("[1/1]"),n.subject(-1n,2n).expect("negative").to_equal("[1/2]"),n.subject(0n,1n).expect("negative").to_equal("[0/1]"),n.subject(1n,2n).expect("negative").to_equal("[-1/2]"),n.subject(1n,1n).expect("negative").to_equal("[-1/1]"),n.subject(3n,2n).expect("negative").to_equal("[-3/2]"),n.subject(2n,1n).expect("negative").to_equal("[-2/1]"),n.subject(1n,0n).expect("negative").to_equal("[-1/0]"),n.subject(0n,0n).expect("absolute").to_equal("[0/0]"),n.subject(-1n,0n).expect("absolute").to_equal("[1/0]"),n.subject(-2n,1n).expect("absolute").to_equal("[2/1]"),n.subject(-3n,2n).expect("absolute").to_equal("[3/2]"),n.subject(-1n,1n).expect("absolute").to_equal("[1/1]"),n.subject(-1n,2n).expect("absolute").to_equal("[1/2]"),n.subject(0n,1n).expect("absolute").to_equal("[0/1]"),n.subject(1n,2n).expect("absolute").to_equal("[1/2]"),n.subject(1n,1n).expect("absolute").to_equal("[1/1]"),n.subject(3n,2n).expect("absolute").to_equal("[3/2]"),n.subject(2n,1n).expect("absolute").to_equal("[2/1]"),n.subject(1n,0n).expect("absolute").to_equal("[1/0]"),n.subject(0n,0n).expect("truncate").to_equal("[0/0]"),n.subject(-1n,0n).expect("truncate").to_equal("[-1/0]"),n.subject(-2n,1n).expect("truncate").to_equal("[-2/1]"),n.subject(-3n,2n).expect("truncate").to_equal("[-1/1]"),n.subject(-1n,1n).expect("truncate").to_equal("[-1/1]"),n.subject(-1n,2n).expect("truncate").to_equal("[0/1]"),n.subject(0n,1n).expect("truncate").to_equal("[0/1]"),n.subject(1n,2n).expect("truncate").to_equal("[0/1]"),n.subject(1n,1n).expect("truncate").to_equal("[1/1]"),n.subject(3n,2n).expect("truncate").to_equal("[1/1]"),n.subject(2n,1n).expect("truncate").to_equal("[2/1]"),n.subject(1n,0n).expect("truncate").to_equal("[1/0]"),n.subject(0n,0n).expect("floor").to_equal("[0/0]"),n.subject(-1n,0n).expect("floor").to_equal("[-1/0]"),n.subject(-2n,1n).expect("floor").to_equal("[-2/1]"),n.subject(-3n,2n).expect("floor").to_equal("[-2/1]"),n.subject(-1n,1n).expect("floor").to_equal("[-1/1]"),n.subject(-1n,2n).expect("floor").to_equal("[-1/1]"),n.subject(0n,1n).expect("floor").to_equal("[0/1]"),n.subject(1n,2n).expect("floor").to_equal("[0/1]"),n.subject(1n,1n).expect("floor").to_equal("[1/1]"),n.subject(3n,2n).expect("floor").to_equal("[1/1]"),n.subject(2n,1n).expect("floor").to_equal("[2/1]"),n.subject(1n,0n).expect("floor").to_equal("[1/0]"),n.subject(0n,0n).expect("ceiling").to_equal("[0/0]"),n.subject(-1n,0n).expect("ceiling").to_equal("[-1/0]"),n.subject(-2n,1n).expect("ceiling").to_equal("[-2/1]"),n.subject(-3n,2n).expect("ceiling").to_equal("[-1/1]"),n.subject(-1n,1n).expect("ceiling").to_equal("[-1/1]"),n.subject(-1n,2n).expect("ceiling").to_equal("[0/1]"),n.subject(0n,1n).expect("ceiling").to_equal("[0/1]"),n.subject(1n,2n).expect("ceiling").to_equal("[1/1]"),n.subject(1n,1n).expect("ceiling").to_equal("[1/1]"),n.subject(3n,2n).expect("ceiling").to_equal("[2/1]"),n.subject(2n,1n).expect("ceiling").to_equal("[2/1]"),n.subject(1n,0n).expect("ceiling").to_equal("[1/0]"),n.summarise()}}function u(t){if(t.is_negative()){const[e,n]=u(t.negative());return[e.negative(),n]}if(t.is_infinite())return[t];if(t.is_zero())return[t,0n];let e=t,n=0n;for(;e.is_less_than(l.ONE);)e=e.times(l.TEN),n--;for(;e.is_not_less_than(l.TEN);)e=e.divide(l.TEN),n++;return[e,n]}const h=[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"],[.5,"s"],[5/12,"⁙"],[4/12,"∷"],[.25,"∴"],[2/12,":"],[1/12,"·"]];function d(t){if(t.is_negative())return d(t.negative());t.is_greater_than(1e5)&&(t=new l(1e5));for(const[e,n]of h)if(t.is_not_less_than(e))return n+d(t.minus(e));return""}function p(t,e=!0){if(t.is_negative())return["negative",...p(t.negative(),!1)];if(t.is_infinite())return["infinity"];const n=["vigintillion","novemdecillion","octodecillion","septendecillion","sexdecillion","quindecillion","quattuordecillion","tredecillion","duodecillion","undecillion","decillion","nonillion","octillion","septillion","sextillion","quintillion","quadrillion","trillion","billion","million","thousand"];if(t.is_not_less_than(1000n**BigInt(n.length+1)))return["too large to show"];if(t.is_fractional()){const e=t.modulo(1),n=new l(e.numerator),s=new l(e.denominator),i=p(t.truncate(),!1),o=p(n);i.length>0&&(i.push("and"),"one"===o[0]&&(o[0]="a"));const a={2:["half"],4:["quarter"]}[s.to_float()]??p(s);return"one"===a[0]&&a.splice(0,1),a[a.length-1]=(a[a.length-1]+(n.is_greater_than(1)?"ths":"th")).replace(/halfth/,"half").replace(/quarterth/,"quarter").replace(/oneth/,"first").replace(/twoth/,"second").replace(/threeth/,"third").replace(/fiveth/,"fifth").replace(/eightth/,"eighth").replace(/nineth/,"ninth").replace(/twelveth/,"twelfth").replace(/twentyth/,"twentieth").replace(/tyth/,"tieth"),[...i,...o,...a]}if(t.is_zero()&&!e)return[];if(t.to_float()<20)return[["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"][t.to_float()]];if(t.to_float()<100)return[["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"][Math.floor(t.to_float()/10)],...p(new l(t.numerator%10n),!1)];if(t.to_float()<1e3){const e=p(new l(t.numerator%100n),!1);return[...p(t.divide(new l(100n)).truncate()),"hundred",...e.length>0?["and"]:[],...e]}const s=[];n.forEach(((e,i)=>{const o=1000n**BigInt(n.length-i),a=p(new l(t.numerator,o).modulo(1000n).truncate(),!1);a.length>0&&s.push(...a,e)}));const i=p(new l(t.numerator%1000n),!1);return i.length>0&&(i.includes("and")||s.push("and"),s.push(...i)),s}function _(t){return p(t).join(" ")}class f{static DOTS={1:{size:1,dots:[{x:0,y:0}]},2:{size:2,dots:[{x:0,y:0},{x:1,y:1}]},3:{size:2.5,dots:[{x:0,y:0},{x:.75,y:.75},{x:1.5,y:1.5}]},4:{size:2.5,dots:[{x:0,y:0},{x:1.5,y:0},{x:0,y:1.5},{x:1.5,y:1.5}]},5:{size:2.5,dots:[{x:0,y:0},{x:1.5,y:0},{x:.75,y:.75},{x:0,y:1.5},{x:1.5,y:1.5}]},6:{size:3,dots:[{x:0,y:0},{x:2,y:0},{x:0,y:1},{x:2,y:1},{x:0,y:2},{x:2,y:2}]}};static base(){const t=document.createElement("div");return t.classList.add("face"),t}static text(t,e){return i(t,f.base(),e)}static dots(t,e){const n=f.base(),s=t.absolute(),i=s.is_less_than(1)?1:s.is_greater_than(256)?256:Math.ceil(s.to_float());let{size:o,dots:a}=f.DOTS[i]??{size:Math.ceil(Math.sqrt(i))},r=o,c=Math.ceil(i/o),l=o,u=i/l;for(;u>1&&l<=16;){if(u%1==0){r=l,c=u;break}l++,u=i/l}const h=3*r+1,d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttribute("xmlns","http://www.w3.org/2000/svg"),d.setAttribute("viewBox",`0 0 ${h} ${h}`),d.setAttribute("width","100%"),d.setAttribute("height","100%"),n.append(d);for(let t=0;t<i&&(!s.is_not_greater_than(0)||!s.is_greater_than(0));t++){const{x:n,y:i}=a?a[t]:{x:t%r,y:(r-c)/2+Math.floor(t/r)},o=document.createElementNS("http://www.w3.org/2000/svg","circle");if(o.setAttribute("cx",""+(3*n+2)),o.setAttribute("cy",""+(3*i+2)),o.setAttribute("r","1"),d.append(o),s.is_not_less_than(t+1))o.setAttribute("fill",e);else{o.setAttribute("r","0.95"),o.setAttribute("fill","none"),o.setAttribute("stroke",e),o.setAttribute("stroke-width","0.1"),o.setAttribute("stroke-dasharray","0.2");const t=document.createElementNS("http://www.w3.org/2000/svg","path"),a=s.modulo(1).to_float(),r=2*a*Math.PI%Math.PI;t.setAttribute("d",[`M ${3*n+2},${3*i+2}`,"v -1",a<.5?[`a 1,1 0,0,0 ${-Math.sin(r)},${1-Math.cos(r)}`]:["a 1,1 0,0,0 0,2",`a 1,1 0,0,0 ${Math.sin(r)},${Math.cos(r)-1}`],"z"].join(" ")),t.setAttribute("fill",e),d.append(t)}}return n}static fraction(t){if(t.is_integer())return f.text(t.to_positional({integer:{group_separator:","}}));{const e=document.createElement("div");return e.classList.add("fraction"),e.append(new l(t.numerator).to_positional({integer:{group_separator:","}})),e.append(document.createElement("div")),e.append(new l(t.denominator).to_positional({integer:{group_separator:","}})),f.text(e)}}static decimal(t){return f.text(t.to_positional({integer:{group_separator:","}}))}static word(t){return f.text(_(t).toUpperCase(),16)}static roman(t){const e=f.text(d(t));return e.style.fontFamily="serif",e}static scientific(t){let[e,n]=u(t);e=e.round(void 0,l.THOUSANDTH),e.is_not_less_than(l.TEN)&&(e=l.ONE,n++);const s=document.createElement("span");if(s.append(e.to_positional({fraction:{min_digits:3,max_digits:3}})),void 0!==n){s.append(" × 10");const t=document.createElement("sup");t.append(n.toString()),s.append(t)}return f.text(s)}}class m extends t{mass=5;slots=[];button;operate;static create(t,e,n){const s=new m(t,e);return s.set_position(n),document.body.append(s.element),s}constructor(t,e){const n=document.createElement("div");n.classList.add("block-operation"),super(n);const i=document.createElement("div");i.classList.add("face","front"),n.append(i);const o=document.createElement("div");o.classList.add("spacer"),i.append(o);const a=document.createElement("div");a.classList.add("operation-row"),t.split("#").forEach(((t,e)=>{if(e>0){const t=document.createElement("div");t.classList.add("slot"),["back","left","right","top","bottom"].forEach((e=>{const n=document.createElement("div");n.classList.add("face",e),t.append(n)})),a.append(t),this.slots.push({element:t})}const n=document.createElement("div");n.classList.add("blue"),t&&n.classList.add("text"),n.innerText=t,a.append(n)}));const r=document.createElement("div");r.classList.add("button-slot"),a.append(r);const c=s.create(f.text("="),(()=>this.evaluate()),(()=>this.slots.every((t=>t.block))),[0,0]);c.physics_enabled=!1,c.shadow.classList.add("hidden"),this.button={element:r,block:c},i.append(a);const l=document.createElement("div");l.classList.add("spacer"),i.append(l),this.size=[0,70],n.append(this.face("left")),n.append(this.face("right")),n.append(this.face("top")),n.append(this.face("bottom")),setTimeout((()=>this.size[0]=i.scrollWidth)),this.operate=e}face(t){const e=document.createElement("div");if(e.classList.add("face",t),"right"===t){const t=document.createElement("div");t.classList.add("hole"),e.append(t)}return e}update(){super.update(),this.slots.forEach((t=>{if(t.block){const e=[this.position[0]+t.element.offsetLeft,this.position[1]+10];t.block.elevation=this.elevation+55,t.block.set_position(e)}}));const t=[this.position[0]+10+this.button.element.offsetLeft,this.position[1]+20];this.button.block.elevation=this.elevation+70,this.button.block.set_position(t)}evaluate(){const t=[this.position[0]+this.size[0]-50,this.position[1]+10],e=this.slots.map((t=>t.block.value)),n=this.operate(...e),s=g.create(n,t,10);s.velocity[0]=30,s.velocity[1]=Math.random()-.5}}class g extends t{value;static MODE="dots";static SIZE=50;static FACE_TRANSFORMS={dots:["",""],fraction:["rotateY(270deg)","rotateY(90deg)"],decimal:["rotateY(180deg)","rotateY(180deg)"],word:["rotateY(90deg)","rotateY(270deg)"],roman:["rotateX(270deg)","rotateX(90deg)"],scientific:["rotateX(90deg)","rotateX(270deg)"]};size=[g.SIZE,g.SIZE];elevation=25;in_slot;faces={};static create(t,e,n=0){const s=new g(t);return s.set_position(e),s.change_mode(g.MODE,n),document.body.append(s.element),s}static set_mode(e){g.MODE=e,t.instances.forEach((t=>{t instanceof g&&t.change_mode(e)}))}constructor(t){const e=document.createElement("div");if(e.classList.add("block-number"),super(e),this.value=t,e.style.color=this.colour(),this.value.is_undefined()){e.classList.add("error");const t=this.face_base("dots",f.text("ERROR"));t.classList.add("front"),e.append(t),e.append(this.face_base("fraction")),e.append(this.face_base("decimal")),e.append(this.face_base("word")),e.append(this.face_base("roman")),e.append(this.face_base("scientific"))}else e.append(this.face_dots()),e.append(this.face_fraction()),e.append(this.face_decimal()),e.append(this.face_word()),e.append(this.face_roman()),e.append(this.face_scientific())}colour(){const t=this.value.to_float();let e=240;return t>0?e=165-30/(1+t):t<0&&(e=315+30/(1-t)),`hsl(${e}deg, 100%, ${25+10/(1+Math.abs(t))}%)`}change_mode(t,e=50){if(!this.value.is_undefined()){const n=()=>{this.transforms=[g.FACE_TRANSFORMS[t][1]],Object.values(this.faces).forEach((t=>t.classList.remove("front"))),this.faces[t].classList.add("front"),this.update(),e&&(this.shadow.classList.add("lifted"),setTimeout((()=>{this.elevation-=e,this.update()}),100))};e&&document.body.contains(this.element)?(this.elevation+=e,this.update(),this.shadow.classList.add("lifted"),setTimeout(n,100)):n()}}face_base(t,e=f.base()){return e.style.transform=[g.FACE_TRANSFORMS[t][0],`translateZ(${g.SIZE/2}px)`].join(" "),this.faces[t]=e,e}face_decimal(){return this.face_base("decimal",f.decimal(this.value))}face_dots(){return this.face_base("dots",f.dots(this.value,this.colour()))}face_fraction(){return this.face_base("fraction",f.fraction(this.value))}face_word(){return this.face_base("word",f.word(this.value))}face_roman(){return this.face_base("roman",f.roman(this.value))}face_scientific(){return this.face_base("scientific",f.scientific(this.value))}on_lift(){if(this.in_slot){const t=this.in_slot;this.in_slot=null,this.elevation=125,this.physics_enabled=!0,this.shadow.classList.remove("hidden"),t.block=null}}on_drop(){t.instances.forEach((t=>{t instanceof m&&t.slots.forEach((e=>{if(!e.block){const n=[t.position[0]+e.element.offsetLeft,t.position[1]+10];Math.abs(n[0]-this.position[0])<25&&Math.abs(n[1]-this.position[1])<25&&(this.in_slot=e,this.physics_enabled=!1,this.shadow.classList.add("hidden"),e.block=this,t.update())}}))}))}}[{face:f.dots(new l(3),"#000000"),mode:"dots"},{face:f.fraction(new l(.5)),mode:"fraction"},{face:f.decimal(new l(1.5)),mode:"decimal"},{face:f.word(new l(2)),mode:"word"},{face:f.roman(new l(4)),mode:"roman"},{face:f.scientific(new l(1200)),mode:"scientific"}].forEach((({face:t,mode:e},n)=>s.create(t,(()=>g.set_mode(e)),(()=>g.MODE!==e),[15+45*n,15]))),[new l(1),new l(1)].forEach(((t,e)=>g.create(t,[50+75*e,100]))),[{text:"# + #",op:(t,e)=>t.plus(e)},{text:"# - #",op:(t,e)=>t.minus(e)},{text:"# × #",op:(t,e)=>t.times(e)},{text:"# ÷ #",op:(t,e)=>t.divide(e)}].forEach((({text:t,op:e},n)=>m.create(t,e,[50,200+100*n]))),setTimeout((()=>t.instances.forEach((t=>t.update())))),l.test(!0)})()})();